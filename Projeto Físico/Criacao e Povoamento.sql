-- CRIACAO BANCO DE DADOS

-- TABELA EVENTO_CONTRATO
CREATE TABLE EventoContrato ( 
    COD_EV NUMBER(4) PRIMARY KEY, 
    NOME VARCHAR(10), 
    TIPO VARCHAR(6) NOT NULL, 
    COD_CON NUMBER(4) NOT NULL UNIQUE,
    VALOR NUMBER(7, 2) NOT NULL, 
    DATA DATE,
    LOC_NUM NUMBER(4) NOT NULL, 
    LOC_CEP NUMBER(4) NOT NULL, 
    LOC_END VARCHAR(10) NOT NULL
);

-- TABELA FUNCIONÁRIO
CREATE TABLE FUNCIONARIO (
    CPF VARCHAR(4) PRIMARY KEY,
    NOME VARCHAR(10) NOT NULL,
    EMAIL VARCHAR(20),
    TELEFONE1 VARCHAR(15),
    TELEFONE2 VARCHAR(15),
    SALARIO NUMBER(6, 2),
    CPF_CHEFE VARCHAR(4),
    CONSTRAINT FK_CHEFE FOREIGN KEY (CPF_CHEFE) REFERENCES FUNCIONARIO(CPF)
);

-- TABELA TRABALHA -> RELACIONA FUNCIONÁRIO E EVENTO
CREATE TABLE TRABALHA(
    CPF VARCHAR(4),
    COD_EV NUMBER(4),
    CONSTRAINT PK_TB PRIMARY KEY (CPF, COD_EV),
    CONSTRAINT FK_FUNC FOREIGN KEY (CPF) REFERENCES FUNCIONARIO(CPF),
    CONSTRAINT FK_E FOREIGN KEY (COD_EV) REFERENCES EventoContrato(COD_EV)
);

-- TABELA OUVINTE
CREATE TABLE OUVINTE (
    CPF VARCHAR(4) PRIMARY KEY,
    NOME VARCHAR(10) NOT NULL,
    EMAIL VARCHAR(20),
    TELEFONE1 VARCHAR(15),
    TELEFONE2 VARCHAR(15)
);

--  TABELA APRESENTADOR
CREATE TABLE APRESENTADOR (
    CPF VARCHAR(4) PRIMARY KEY,
    NOME VARCHAR(10) NOT NULL,
    EMAIL VARCHAR(20),
    TELEFONE1 VARCHAR(15),
    TELEFONE2 VARCHAR(15),
    COMISSAO NUMBER(6, 2)
);

-- TABELA SALA
CREATE TABLE SALA (
    NUMERO NUMBER(2) PRIMARY KEY,
    CPF VARCHAR(4) UNIQUE,
    CONSTRAINT FK_SALA_RESP FOREIGN KEY (CPF) REFERENCES FUNCIONARIO(CPF)
);

-- TABELA SECAO 
CREATE TABLE SECAO ( 
    NUM_SECAO NUMBER(4) NOT NULL, 
    COD_EV NUMBER(4), 
    CONSTRAINT PK_SES PRIMARY KEY (NUM_SECAO, COD_EV), 
    CONSTRAINT FK_EV FOREIGN KEY (COD_EV) REFERENCES EventoContrato (COD_EV) 
);

-- TABELA OCORRE -> RELACIONA SALA E SECAO
CREATE TABLE OCORRE(
    NUM_SALA NUMBER(2),
    NUM_SECAO NUMBER(4), 
    COD_EV NUMBER(4), 
    DATA_HORA TIMESTAMP,
    CONSTRAINT AK_OCOORE UNIQUE (DATA_HORA, NUM_SALA, NUM_SECAO, COD_EV),
    --CONSTRAINT PK_OCORRE PRIMARY KEY (NUM_SALA, NUM_SECAO, COD_EV),
    CONSTRAINT FK_SALA FOREIGN KEY (NUM_SALA) REFERENCES SALA (NUMERO),
    CONSTRAINT FK_SES FOREIGN KEY (NUM_SECAO, COD_EV) REFERENCES SECAO(NUM_SECAO, COD_EV)
);

-- TABELA APRESENTACAO -> RELACIONA APRESENTADOR, OUVINTE, SECAO, EVENTO
CREATE TABLE APRESENTACAO ( 
    CPF_APRESENTADOR VARCHAR(4), 
    CPF_OUVINTE VARCHAR(4), 
    NUM_SECAO NUMBER(4), 
    COD_EV NUMBER(4), 
    TITULO VARCHAR(20) NOT NULL,
    CONSTRAINT PK_APS PRIMARY KEY (CPF_APRESENTADOR, CPF_OUVINTE, NUM_SECAO, COD_EV, TITULO),
    CONSTRAINT FK_APRESENTADOR FOREIGN KEY (CPF_APRESENTADOR) REFERENCES APRESENTADOR(CPF), 
    CONSTRAINT FK_OUVINTE FOREIGN KEY (CPF_OUVINTE) REFERENCES OUVINTE(CPF),
    CONSTRAINT FK_SES_APS FOREIGN KEY (NUM_SECAO, COD_EV) REFERENCES SECAO(NUM_SECAO, COD_EV)
);

-- TABELA DESCONTO
CREATE TABLE DESCONTO (
    COD_DESC NUMBER(2) PRIMARY KEY,
    PORCENTAGEM NUMBER(3, 2)
); 

-- TABELA INGRESSO
CREATE TABLE INGRESSO (
    QR_CODE NUMBER(4) PRIMARY KEY,
    VALOR NUMBER(5, 2)
);

-- TABELA COMPRA -> RELACIONA INGRESSO E OUVINTE COM DESCONTO 
CREATE TABLE COMPRA(
    CPF_OUVINTE VARCHAR(4),
    QR_CODE NUMBER(4),
    COD_DESC NUMBER(2),
    CONSTRAINT PK_COMPRA PRIMARY KEY (CPF_OUVINTE, QR_CODE),
    CONSTRAINT FK_PESSOA FOREIGN KEY (CPF_OUVINTE) REFERENCES OUVINTE (CPF),
    CONSTRAINT FK_INGRESSO FOREIGN KEY (QR_CODE) REFERENCES INGRESSO (QR_CODE),
    CONSTRAINT FK_DESC FOREIGN KEY (COD_DESC) REFERENCES DESCONTO (COD_DESC)
);

--- POVOAMENTO ---

INSERT INTO EventoContrato VALUES(0001, 'EVENTO1', 'TIPO1', 0001, 1000, TO_DATE('09/03/2025','DD/MM/YYYY'), 0001, 0001, 'ABCD');
INSERT INTO EventoContrato VALUES(0002, 'EVENTO2', 'TIPO2', 0002, 1000, TO_DATE('19/03/2025','DD/MM/YYYY'), 0001, 0001, 'ABCD');
INSERT INTO EventoContrato VALUES(0003, 'EVENTO1', 'TIPO1', 0003, 1000, TO_DATE('29/03/2025','DD/MM/YYYY'), 0001, 0001, 'ABCD');


INSERT INTO FUNCIONARIO (CPF, NOME, EMAIL, TELEFONE1, SALARIO)VALUES ('0111', 'A', 'AF@gmail.com', '(81) 1000-1000', 2500.45);
INSERT INTO FUNCIONARIO VALUES ('0112', 'B', 'BF@gmail.com', '(81) 1000-1000', '(81) 2000-2000', 2000, '0111');
INSERT INTO FUNCIONARIO VALUES ('0113', 'C', 'CF@gmail.com', '(81) 1001-1001', '(81) 2001-2001', 2000, '0111');

INSERT INTO TRABALHA VALUES ('0111', 0003);
INSERT INTO TRABALHA VALUES ('0111', 0002);
INSERT INTO TRABALHA VALUES ('0112', 0002);
INSERT INTO TRABALHA VALUES ('0113', 0003);

INSERT INTO OUVINTE (CPF, NOME, EMAIL, TELEFONE1)VALUES ('0221', 'A_O', 'AO@gmail.com', '(81) 1000-1007');
INSERT INTO OUVINTE VALUES ('0222', 'B_O', 'BO@gmail.com', '(81) 1002-1002', '(81) 2002-2002');
INSERT INTO OUVINTE VALUES ('0223', 'C_O', 'CO@gmail.com', '(81) 1003-1003', '(81) 2003-2003');

INSERT INTO APRESENTADOR (CPF, NOME, EMAIL, TELEFONE1, COMISSAO) VALUES ('0331', 'A_A', 'AA@gmail.com', '(81) 1000-1009', 1000);
INSERT INTO APRESENTADOR VALUES ('0332', 'B_A', 'BA@gmail.com', '(81) 1004-1004', '(81) 2004-2004', 1000.5);
INSERT INTO APRESENTADOR VALUES ('0333', 'C_A', 'CA@gmail.com', '(81) 1005-1005', '(81) 2005-2005', 1000);

INSERT INTO SALA VALUES (01, '0111');
INSERT INTO SALA VALUES (02, '0112');
INSERT INTO SALA (NUMERO) VALUES (03);

INSERT INTO SECAO VALUES (0101, 0001);
INSERT INTO SECAO VALUES (0102, 0002);
INSERT INTO SECAO VALUES (0103, 0003);

INSERT INTO OCORRE VALUES (01, 0101, 0001, TO_TIMESTAMP('10-MAR-2514:10:10.123000','DD-MON-RRHH24:MI:SS.FF'));
INSERT INTO OCORRE VALUES (01, 0101, 0001, TO_TIMESTAMP('16-MAR-2514:10:10.123000','DD-MON-RRHH24:MI:SS.FF'));
INSERT INTO OCORRE VALUES (01, 0101, 0001, TO_TIMESTAMP('10-MAR-2514:07:10.123000','DD-MON-RRHH24:MI:SS.FF'));
INSERT INTO OCORRE VALUES (02, 0102, 0002, TO_TIMESTAMP('10-MAR-2514:10:10.123000','DD-MON-RRHH24:MI:SS.FF'));
INSERT INTO OCORRE VALUES (03, 0101, 0001, TO_TIMESTAMP('10-MAR-2514:10:10.123000','DD-MON-RRHH24:MI:SS.FF'));

INSERT INTO APRESENTACAO VALUES ('0331', '0221', 0101, 0001, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0222', 0101, 0001, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0223', 0101, 0001, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0221', 0101, 0001, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0222', 0101, 0001, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0223', 0101, 0001, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0221', 0102, 0002, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0222', 0102, 0002, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0223', 0102, 0002, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0221', 0102, 0002, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0222', 0102, 0002, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0331', '0223', 0102, 0002, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0332', '0221', 0103, 0003, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0332', '0222', 0103, 0003, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0332', '0223', 0103, 0003, '1 APS');
INSERT INTO APRESENTACAO VALUES ('0333', '0221', 0103, 0003, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0333', '0222', 0103, 0003, '2 APS');
INSERT INTO APRESENTACAO VALUES ('0333', '0223', 0103, 0003, '2 APS');

INSERT INTO DESCONTO VALUES (01, 0.05);
INSERT INTO DESCONTO VALUES (02, 0.1);
INSERT INTO DESCONTO VALUES (03, 0.25);

INSERT INTO INGRESSO VALUES (01, 24.99);
INSERT INTO INGRESSO VALUES (02, 49.99);
INSERT INTO INGRESSO VALUES (03, 99.99);

INSERT INTO COMPRA VALUES ('0221', 01, NULL);
INSERT INTO COMPRA VALUES ('0222', 02, 02);
INSERT INTO COMPRA VALUES ('0223', 03, 03);
